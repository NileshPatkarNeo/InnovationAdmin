@model IEnumerable<Innovation_Admin.UI.Models.AdminRole.AdminRoleDto>

@{
    ViewData["Title"] = "AdminRole";
    Layout = "~/Views/Shared/_AdminHomePage.cshtml";
}

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css">
    <style>
        .search-container {
            display: flex;
            align-items: center;
            margin-top: 20px;
            margin-bottom: 20px;
            width: 50%; /* Adjusted to half width */
        }

        .search-bar {
            flex: 1;
            margin-right: 10px;
        }

        .search-buttons button {
            margin-left: 5px;
        }

        h1.text-center {
            margin-bottom: 20px;
        }

        .table {
            margin-top: 30px;
            border: 1px solid #dee2e6;
        }

            .table th, .table td {
                vertical-align: middle;
                text-align: center;
            }

            .table th {
                background-color: #f8f9fa;
            }

        .table-bordered th, .table-bordered td {
            border: 1px solid #dee2e6;
        }

        .btn {
            margin: 2px;
        }
    </style>
</head>

<h1 class="text-center">Admin Role</h1>

<div class="search-container">
    <div class="search-bar">
        <input type="text" id="searchInput" class="form-control" placeholder="Search by Role Name">
    </div>
    <div class="search-buttons">
        <button id="searchButton" class="btn btn-primary"><i class="bi bi-search"></i> </button>
        <button id="sortButton" class="btn btn-secondary"><i class="bi bi-sort-numeric-down"></i> </button>
    </div>
</div>

<div class="text-end">
    <a asp-action="CreateAdminRole" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Add
    </a>
</div>

<table class="table table-bordered table-hover">
    <thead class="table-light">
        <tr>
            <th>Sr.No</th>
            <th style="display:none">@Html.DisplayNameFor(model => model.Role_ID)</th>
            <th>Role Name</th>
            <th>@Html.DisplayNameFor(model => model.Description)</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody id="tableBody">
        @{
            int serialNumber = 1;
        }
        @foreach (var item in Model)
        {
            <tr>
                <td>@serialNumber</td>
                <td style="display:none">@Html.DisplayFor(modelItem => item.Role_ID)</td>
                <td>@Html.DisplayFor(modelItem => item.Role_Name)</td>
                <td>@Html.DisplayFor(modelItem => item.Description)</td>
                <td>
                    <a href="@Url.Action("EditAdminRole", new { adminRoleId = item.Role_ID })" class="btn btn-warning btn-sm">
                        <i class="bi bi-pencil-fill"></i>
                    </a>
                    <a href="#" class="btn btn-danger btn-sm" onclick="confirmDelete('@item.Role_ID')">
                        <i class="bi bi-trash-fill"></i>
                    </a>
                </td>
            </tr>
            serialNumber++;
        }
    </tbody>
</table>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $('#searchButton').on('click', function () {
            searchTable();
        });

        $('#sortButton').on('click', function () {
            sortTable();
        });

        $('#searchInput').on('input', function () {
            if (!this.value) {
                resetTable();
            }
        });
    });

    function searchTable() {
        var value = $('#searchInput').val().toLowerCase();
        $('#tableBody tr').each(function () {
            var roleName = $(this).find('td:eq(2)').text().toLowerCase();
            $(this).toggle(roleName.includes(value));
        });
        updateSerialNumbers();
    }

    function resetTable() {
        $('#tableBody tr').show();
        updateSerialNumbers();
    }

    function sortTable() {
        var rows = $('#tableBody tr').get();
        var order = $('#sortButton').data('order') || 'asc';

        rows.sort(function (a, b) {
            var valueA = parseInt($(a).find('td:eq(0)').text());
            var valueB = parseInt($(b).find('td:eq(0)').text());

            if (order === 'asc') {
                return valueA - valueB;
            } else {
                return valueB - valueA;
            }
        });

        $.each(rows, function (index, row) {
            $('#tableBody').append(row);
        });

        $('#sortButton').data('order', order === 'asc' ? 'desc' : 'asc');
        $('#sortButton').find('i').toggleClass('bi-sort-numeric-down bi-sort-numeric-up');
    }

    function updateSerialNumbers() {
        $('#tableBody tr:visible').each(function (index) {
            $(this).find('td:eq(0)').text(index + 1);
        });
    }

    function confirmDelete(roleId) {
        if (confirm("Are you sure you want to delete this Admin Role?")) {
            var form = document.createElement("form");
            form.method = "post";
            form.action = "/Common/DeleteAdminRole";

            var hiddenField = document.createElement("input");
            hiddenField.type = "hidden";
            hiddenField.name = "adminRoleId";
            hiddenField.value = roleId;
            form.appendChild(hiddenField);

            document.body.appendChild(form);
            form.submit();
        }
    }
</script>
